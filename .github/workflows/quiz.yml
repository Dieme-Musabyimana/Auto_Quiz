name: Run Quiz Bot

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 120

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'microsoft'
          cache: maven

      # Install Linux dependencies first
      - name: Install Playwright Linux Dependencies
        run: sudo mvn -DskipTests exec:java -Dexec.mainClass=com.microsoft.playwright.CLI -Dexec.args="install-deps"

      # Install Playwright browsers
      - name: Install Playwright Browsers
        run: mvn -DskipTests exec:java -Dexec.mainClass=com.microsoft.playwright.CLI -Dexec.args="install"

      # Run your bot (correct class name)
      - name: Run Bot
        env:
          LOGIN_PHONE: ${{ secrets.LOGIN_PHONE }}
          LOGIN_PIN: ${{ secrets.LOGIN_PIN }}
          LOGIN_LINK: ${{ secrets.LOGIN_LINK }}
          API_KEY: ${{ secrets.API_KEY }}
          AI_SERVICE_LINK: ${{ secrets.AI_SERVICE_LINK }}
        run: |
          echo "ðŸŸ¢ Starting Quiz Bot..."
          mvn compile exec:java -Dexec.mainClass=DoQuizTest

      - name: Upload Debug Artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: bot-debug
          path: |
            statistics.json
            state.json
