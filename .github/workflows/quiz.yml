name: Run Quiz Bot
on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 25
        uses: actions/setup-java@v4
        with:
          java-version: '25'
          distribution: 'microsoft'
          cache: maven

      - name: Install Playwright Browsers
        # We use the double path because your pom.xml is nested two levels deep
        working-directory: ./Auto_Quiz/Auto_Quiz  
        run: mvn exec:java -e -Dexec.mainClass="com.microsoft.playwright.CLI" -Dexec.args="install chromium"

      - name: Run Bot
        working-directory: ./Auto_Quiz/Auto_Quiz  
        env:
          QUIZ_LINK: ${{ secrets.QUIZ_LINK }}
          LOGIN_PHONE: ${{ secrets.LOGIN_PHONE }}
          LOGIN_PIN: ${{ secrets.LOGIN_PIN }}
          LOGIN_LINK: ${{ secrets.LOGIN_LINK }}
        run: mvn test -Dtest=DoQuizTest

      - name: Commit and Push Progress
        run: |
          git config --global user.name "QuizBot"
          git config --global user.email "bot@github.com"
          
          # Adjusting these paths to match your double-folder structure
          if [ -f "Auto_Quiz/Auto_Quiz/statistics.json" ]; then 
            git add Auto_Quiz/Auto_Quiz/statistics.json
          fi
          
          if [ -d "Auto_Quiz/Auto_Quiz/bot_profile" ]; then
            git add Auto_Quiz/Auto_Quiz/bot_profile/
          fi

          if git diff --staged --quiet; then
            echo "No changes to commit."
          else
            git commit -m "ðŸ¤– Update learned answers [skip ci]"
            git push
          fi
