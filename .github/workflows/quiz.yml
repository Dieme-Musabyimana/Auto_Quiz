name: Run Quiz Bot                         # Name of the workflow
on:                                        # When to run
  schedule:
    - cron: '0 * * * *'                    # Every hour
  workflow_dispatch:                       # Manual button

jobs:
  run-bot:                                 # Job ID (no spaces)
    runs-on: ubuntu-latest                 # Use Linux
    steps:
      - uses: actions/checkout@v4          # Get your code

      - name: Set up JDK 25                # Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '25'
          distribution: 'microsoft'
          cache: maven

      - name: Install Playwright Browsers  # Get the browser
        run: mvn exec:java -e -Dexec.mainClass="com.microsoft.playwright.CLI" -Dexec.args="install chromium"

      - name: Run Bot                      # Execute the Java code
        env:                               # Connect your Secrets
          QUIZ_LINK: ${{ secrets.QUIZ_LINK }}
          LOGIN_PHONE: ${{ secrets.LOGIN_PHONE }}
          LOGIN_PIN: ${{ secrets.LOGIN_PIN }}
          LOGIN_LINK: ${{ secrets.LOGIN_LINK }}
        # Changed to DoQuizTest to match your new file name
        run: mvn test -Dtest=DoQuizTest

      - name: Commit and Push Progress
        run: |
          git config --global user.email "bot@github.com"
          git config --global user.name "QuizBot"
          git add statistics.json
          # Check if there are changes before committing to avoid Error 128
          if git diff --staged --quiet; then
            echo "No changes in statistics.json to commit."
          else
            git commit -m "ðŸ”„ Update quiz statistics [skip ci]"
            git push
          fi
