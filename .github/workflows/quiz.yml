name: Run Quiz Bot

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 120

    steps:
      # 1Ô∏è‚É£ Checkout the repository
      - name: Checkout Repo
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Set up JDK 21 (compatible with your code)
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '25'
          distribution: 'microsoft'
          cache: maven

      # 3Ô∏è‚É£ Install Playwright browsers
      - name: Install Playwright Browsers
        run: mvn com.microsoft.playwright:playwright-cli:1.49.0:install

      # 4Ô∏è‚É£ Run the Quiz Bot
      - name: Run Bot
        env:
          LOGIN_PHONE: ${{ secrets.LOGIN_PHONE }}
          LOGIN_PIN: ${{ secrets.LOGIN_PIN }}
          LOGIN_LINK: ${{ secrets.LOGIN_LINK }}
          API_KEY: ${{ secrets.API_KEY }}
          AI_SERVICE_LINK: ${{ secrets.AI_SERVICE_LINK }}
        run: |
          echo "üü¢ Starting Quiz Bot..."
          mvn compile exec:java -Dexec.mainClass="DoQuizTest"

      # 5Ô∏è‚É£ Upload statistics.json and state.json as artifacts for debugging
      - name: Upload Debug Artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: bot-debug
          path: |
            statistics.json
            state.json

      # 6Ô∏è‚É£ Optional: notify on failure (Slack, email, etc.) if needed
